# RFC-0005

# Matroid Independence & Circuit Detection v1.0

## Deterministic Coherence Selection for Semantic Event Sets

Status: Draft
Depends on: RFC-0001, RFC-0002, RFC-0003

---

# 1. Purpose

Defines the formal independence structure over NDJSON semantic events.

The matroid filter selects a **maximally coherent subset** of events.

This is the coherence engine behind:

```
.canvas = C( ùìú( M¬≤(events) ) )
```

---

# 2. Ground Set

Let:

```
E = { e‚ÇÅ, e‚ÇÇ, ‚Ä¶, e‚Çô }
```

Where each element is one of:

* civic_triple
* closure_resolve
* synset_reply
* probe_sensor
* probe_gpio
* commit

Each element must contain:

* basisHash
* self_hash (except pure probes)
* timestamp t

---

# 3. Independence Definition

A subset I ‚äÜ E is independent iff:

### 3.1 Basis Agreement

All events share identical `basisHash`.

### 3.2 Closure Consistency

No two closure_resolve events:

* resolve to different closure_id
* for same target_coord
* within same time window

### 3.3 Drift Threshold

For each synset_reply:

```
drift ‚â§ DRIFT_MAX
```

### 3.4 Face Quorum

For closure_resolve or synset_reply:

```
faces_passed ‚â• FACE_QUORUM
```

### 3.5 No Direct Contradiction

Two civic_triple elements contradict if:

```
subject identical
predicate identical
object negates
```

Negation defined by synset polarity (e.g., prohibit vs allow).

---

# 4. Rank Function

Define rank:

```
r(S) = |maximal independent subset of S|
```

---

# 5. Circuits

A circuit C ‚äÜ E is a minimal dependent subset.

Meaning:

* C is dependent
* All proper subsets of C are independent

Circuits must be recorded for debugging:

```json
{
  "type": "circuit_detected",
  "basisHash": "...",
  "members": ["hash1","hash2"],
  "reason": "contradiction: prohibit vs permit"
}
```

---

# 6. Deterministic Selection Algorithm

Greedy in canonical order:

```
sort E by (t, self_hash)
I = ‚àÖ
for e in E:
  if I ‚à™ {e} independent:
     I = I ‚à™ {e}
  else:
     record circuit
```

This produces a deterministic maximal independent set.

---

# 7. Invariant

Given identical:

* basisHash
* event prefix

Matroid selection MUST produce identical I and identical circuit list.

---

# 8. Complexity

O(n¬≤) acceptable for v1.0
Optimizations MAY be added later.
