# RFC-0002

# Closure Registry Format v1.0

## Deterministic Semantic Closure Declaration & Resolution

Status: Draft
Implements: Portal v1.0, SynsetRPC v0.1

---

# 1. Purpose

The Closure Registry defines the canonical format for declaring executable semantic closures.

A closure is:

> A deterministic procedure bound to synsets, a character face, and a coordinate resolution rule.

Closures are resolved locally by the browser semantic engine.

---

# 2. Design Constraints

1. Deterministic resolution
2. Hashable registry
3. Face-aware routing
4. Drift-scored matching
5. Replay reproducibility

---

# 3. File Location

```
/closure_registry.json
```

Registry MUST be hashable and versioned.

---

# 4. Canonical Structure

```json
{
  "registry_version": "1.0",
  "basisRef": "founding-v1",
  "registry_hash": "sha256-...",
  "closures": []
}
```

---

# 5. Closure Definition

```json
{
  "closure_id": "closure:legislate.prohibition@v1",
  "version": 1,
  "face": "predicate",
  "character": "Solomon",

  "synsets": [
    "legislate.v.01",
    "prohibit.v.01"
  ],

  "intent_tags": [
    "law",
    "policy",
    "constraint"
  ],

  "coordinate_template": {
    "x": 0.8,
    "y": 0.6,
    "z": 0.5,
    "w_rule": "inherit"
  },

  "expected_signals": [
    "policy",
    "law",
    "statute"
  ],

  "execution_model": {
    "type": "pure",
    "deterministic": true
  }
}
```

---

# 6. Fields

| Field               | Description                             |
| ------------------- | --------------------------------------- |
| closure_id          | Globally unique ID                      |
| version             | Monotonic integer                       |
| face                | subject / predicate / object / centroid |
| character           | Solon / Solomon / Asabiyyah / Metatron  |
| synsets             | WordNet anchors                         |
| coordinate_template | Default resolution location             |
| expected_signals    | Keywords for scoring                    |
| execution_model     | Pure or stateful                        |

---

# 7. Resolution Algorithm

Given:

```
probe_synset
probe_sensor
synset_call
```

Resolver computes score:

```
score =
  face_match_weight
+ synset_overlap_weight
+ intent_tag_overlap
+ signal_evidence_weight
- drift_penalty
```

Closure with highest score above threshold wins.

---

# 8. Drift

Drift is Euclidean distance between:

```
requested_coord
resolved_coord
```

Drift threshold MUST be configurable.

---

# 9. Determinism Requirement

Given identical:

* basisHash
* registry_hash
* NDJSON prefix

Resolution MUST produce identical output.

---

# 10. Registry Hash

Registry hash = sha256 of canonical JSON serialization.

Included in every:

```
closure_resolve
synset_reply
commit
```

---

# 11. Security Model

Closures MUST NOT:

* Execute arbitrary JS
* Fetch remote code
* Mutate registry

Execution model is declarative only.

---

# 12. Invariant

> A closure resolution is valid iff it can be reproduced offline from registry + ledger prefix.
