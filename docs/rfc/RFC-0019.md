# RFC-0019

# Canonical Narrative Compression & Bundle Format v1.0

## Deterministic Replayable Semantic World Bundles

Status: Draft
Depends on: RFC-0016

---

# 1. Purpose

Defines portable bundle format containing:

* Canon corpus
* Closure registry
* Initial ledger
* Projection state
* Narrative assets

Enables:

* Offline replay
* Deterministic world extension
* GLB/SVG export

---

# 2. Bundle Container

Extension:

```
.simplex
```

Internally:

```
ZIP container
```

---

# 3. Required Structure

```
bundle.simplex/
 ├── manifest.json
 ├── canon/
 │    ├── Declaration.md
 │    └── Constitution.md
 ├── registry/closure_registry.json
 ├── ledger/events.ndjson
 ├── projection/sab_state.json
 ├── canvas/world.canvas
 └── assets/
      ├── svg/
      └── glb/
```

---

# 4. Manifest Format

```json
{
  "bundle_version":"1.0",
  "basisRef":"founding-v1",
  "basisHash":"sha256-...",
  "registry_hash":"sha256-...",
  "ledger_hash":"sha256-...",
  "sab_hash":"sha256-..."
}
```

---

# 5. Canonical Hashing Rule

Hashes computed per RFC-0016 before bundling.

---

# 6. Compression Rules

* ZIP DEFLATE
* No file reordering
* Deterministic timestamp normalization (set to 0)

---

# 7. Replay Procedure

To load bundle:

1. Verify manifest hashes
2. Load canon
3. Load registry
4. Replay ledger
5. Validate SAB matrix
6. Validate canvas hash

If mismatch → bundle invalid.

---

# 8. Narrative Extension

Bundle may include:

```json
{
  "extension_allowed": true,
  "extension_policy": "append-only"
}
```

Extensions must:

* Maintain basisHash
* Append ledger only
* Pass replay equivalence

---

# 9. GLB Projection

Optional:

* Pre-rendered 3D world exported from canvas
* Must include hash of source canvas

---

# 10. Bundle Invariant

> A valid .simplex bundle must be fully replayable offline to identical semantic state.
